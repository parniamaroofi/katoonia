import{_ as I}from"./BLTjAdUL.js";import{_ as M,t as u,v as f,x as s,z as i,A as a,a8 as v,W as g,N as c,O as E,X as C,y as h,P as p,C as b,B as w,a9 as T,Q as O,aa as L,V as N,a2 as S,ab as B,f as r}from"./DaplssYx.js";import{V as D,f as P}from"./Bn6PYqT_.js";import{s as W}from"./Bw9zdeb-.js";import{_ as z}from"./DTKYH565.js";import"./Dudy9OWa.js";const H={name:"TulipsLandingLogin",setup(){const o=r(1),e=r(""),d=r(null),t=r(""),m=r(60),l=r(!1),x=r(null),n=r(!1),y=r(!1),k=r(!1),V=r(""),_=r(!1);return{code:d,mobile:e,window:o,loading:l,interval:x,countdown:m,resending:n,showError:y,loginData:t,wrongCode:k,errorMessage:V,loginLoading:_}},mounted(){},methods:{makeFocus(){window.innerWidth<1280&&document.getElementById("otpInput").focus()},validMobileNumber(){this.mobile.length>11&&(this.mobile=this.mobile.slice(0,11));var o=/^09\d{9}$/;return o.test(this.mobile)},showErrorMessage(o){this.errorMessage=o,this.showError=!0},async sendOtp(){if(!this.mobile){this.showErrorMessage("شماره موبایل خود را وارد کنید");return}if(!this.validMobileNumber()){this.showErrorMessage("شماره موبایل وارد شده اشتباه است.");return}this.showError=!1,this.loading=!0;try{const{data:o}=await this.$axios.post(P,{mobile:this.mobile});clearInterval(this.interval),this.window=2,this.countdown=60,this.loginData=o,this.countDownTimer(),this.loading=!1,setTimeout(()=>{document.querySelector("#OTP_field >  .v-otp-input__content > .v-field > .v-field__field > input").focus(),window.innerWidth<1280&&document.getElementById("otpInput").focus()},300)}catch(o){this.loading=!1,console.log(o)}},async doLogin(){this.loginLoading=!0,this.wrongCode=!1,this.showError=!1;try{const{data:o}=await this.$axios.post(D,{userId:this.loginData.userId,otpId:this.loginData.otpId,otpCode:String(this.code)});if(console.log(o),this.$cookies.set("KatooniaTOKEN",o.tokens.accessToken,{expires:2592e3,path:"/",maxAge:2592e3}),this.$cookies.set("roleId",2,{expires:2592e3,path:"/",maxAge:2592e3}),localStorage.getItem("returnTo")){const e=localStorage.getItem("returnTo");localStorage.removeItem("returnTo"),window.location.replace(e)}else window.location.replace("/products")}catch(o){this.loginLoading=!1,console.log(o)}},checkOTP(){this.code?this.code.length<4?(this.wrongCode=!1,this.showErrorMessage("کد تایید وارد شده صحیح نیست.")):this.doLogin():this.showErrorMessage("کد تایید را وارد کنید.")},toHHMMSS(o){var e=parseInt(o,10),d=Math.floor(e/3600),t=Math.floor((e-d*3600)/60),m=e-d*3600-t*60;return d<10&&(d="0"+d),t<10&&(t="0"+t),m<10&&(m="0"+m),t+":"+m},countDownTimer(){this.countdown>0&&(this.interval=W(()=>{this.countdown-=1},1e3))},changeMobileNumber(){clearInterval(this.interval),this.code=null,this.window=1},reset(){this.wrongCode=!1,this.showError=!1}},watch:{window(){this.showError=!1,this.wrongCode=!1}}},K={class:"login-page flex justify-center items-center min-h-[100dvh] bg-cover"},U={class:"w-full sm:p-[60px_64px_80px] flex flex-col justify-center md:max-w-[528px] max-w-[85vw] m-auto h-fit rounded-[32px] bg-white/5 backdrop-blur-2xl shadow-2xl"},j={key:0},A={key:0,class:"flex gap-x-2 mt-2 text-red-400"},F={class:"sm:text-[13px] text-[12px] translate-y-0.5"},q={key:0,class:"text-white"},Q={class:"sm:text-[14px] text-[13px] mt-3 text-stone-200"},R={key:0,class:"flex gap-x-2 text-red-400"},X={class:"text-[13px] -translate-y-6"},G={class:"flex justify-between mt-5 z-10"},J={class:"sm:text-[13.5px] text-[13px] pt-1.5"},Y={key:0},Z={class:"number-family"};function $(o,e,d,t,m,l){const x=I;return u(),f("div",K,[s("div",U,[e[18]||(e[18]=s("img",{src:z,alt:"کتونیا katoonia",class:"sm:w-[240px] w-[130px] mb-8 mx-auto"},null,-1)),i(B,{modelValue:t.window,"onUpdate:modelValue":e[10]||(e[10]=n=>t.window=n)},{default:a(()=>[i(v,{value:1},{default:a(()=>[i(g,{name:"fade"},{default:a(()=>[t.window==1?(u(),f("div",j,[e[12]||(e[12]=s("h1",{class:"sm:text-[22px] text-[20px] font-semibold text-white"},"ورود | ثبت‌نام",-1)),e[13]||(e[13]=s("p",{class:"sm:text-[13.5px] text-[12.5px] text-stone-200 mt-1.5"}," لطفا برای ادامه، وارد حساب کاربری خود شوید. ",-1)),s("div",{class:c([t.showError?"h-[80px]":"h-[56px]","duration-500"])},[i(E,{placeholder:"*********09",label:"شماره موبایل",class:"sm:mt-12 mt-8",variant:"outlined",pattern:"[0-9]*",type:"number","hide-details":"",modelValue:t.mobile,"onUpdate:modelValue":e[0]||(e[0]=n=>t.mobile=n),onKeyup:e[1]||(e[1]=C(n=>l.sendOtp(),["enter"])),onInput:e[2]||(e[2]=n=>l.validMobileNumber()?t.showError=!1:"")},null,8,["modelValue"]),i(g,{name:"slide-fade",mode:"in-out"},{default:a(()=>[t.showError?(u(),f("div",A,[s("span",F,h(t.errorMessage),1)])):p("",!0)]),_:1})],2),i(b,{class:"!h-[48px] !w-full sm:mt-8 mt-5",color:"primary",onClick:e[3]||(e[3]=n=>l.sendOtp()),loading:t.loading},{loader:a(()=>[i(x)]),default:a(()=>[e[11]||(e[11]=w(" ادامه و ارسال کد تایید "))]),_:1},8,["loading"])])):p("",!0)]),_:1})]),_:1}),i(v,{value:2},{default:a(()=>[i(g,{name:"fade"},{default:a(()=>[t.window==2?(u(),f("div",q,[e[17]||(e[17]=s("h1",{class:"sm:text-[22px] text-[20px] font-semibold"},"تایید شماره موبایل",-1)),s("p",Q,' کد چهار رقمی ارسال شده به شماره "'+h(t.mobile)+'" را وارد کنید. ',1),s("div",{class:c([t.showError?"h-[90px]":"h-[56px]","duration-500"])},[i(T,{length:4,id:"OTP_field",modelValue:t.code,"onUpdate:modelValue":e[4]||(e[4]=n=>t.code=n),class:c(["mt-4 pb-2",t.wrongCode?"wrongCode":""]),onInput:e[5]||(e[5]=n=>t.code.length==4?l.doLogin():l.reset()),onClick:l.makeFocus},null,8,["modelValue","class","onClick"]),O(s("input",{id:"otpInput","onUpdate:modelValue":e[6]||(e[6]=n=>t.code=n),class:"opacity-0 pointer-events-none",pattern:"[0-9]*",type:"number"},null,512),[[L,t.code]]),i(g,{name:"slide-fade",mode:"in-out"},{default:a(()=>[t.showError?(u(),f("div",R,[s("strong",X,h(t.errorMessage),1)])):p("",!0)]),_:1})],2),s("div",G,[s("div",{class:"hover:text-red-400 group cursor-pointer duration-300 flex gap-x-2 items-center",onClick:e[7]||(e[7]=n=>l.changeMobileNumber())},[i(N,{icon:"svg:edit",class:"fill-white group-hover:fill-red-400 text-[20px] duration-300"}),e[14]||(e[14]=s("span",{class:"sm:text-[13.5px] text-[13px] pt-1.5"},"تغییر شماره موبایل",-1))]),s("div",J,[t.countdown>0?(u(),f("span",Y,[e[15]||(e[15]=w(" ارسال کد ")),s("span",Z," ("+h(l.toHHMMSS(t.countdown))+") ",1)])):(u(),f("span",{key:1,class:"text-white hover:text-red-400 duration-300 cursor-pointer",onClick:e[8]||(e[8]=n=>l.sendOtp()),style:S(t.resending||t.loading?"pointer-events: none":"")},"ارسال مجدد کد",4))])]),i(b,{class:"!h-[48px] !w-full mt-8",color:"primary",onClick:e[9]||(e[9]=n=>l.checkOTP()),loading:t.loginLoading},{loader:a(()=>[i(x)]),default:a(()=>[e[16]||(e[16]=w(" تایید "))]),_:1},8,["loading"])])):p("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[19]||(e[19]=s("div",null,null,-1))])])}const le=M(H,[["render",$]]);export{le as default};
