import{P as o,c as l,d as A,e as n,C as F}from"./Bn6PYqT_.js";import{f as a,U as M}from"./DaplssYx.js";const q={setup(){const t=a({name:"",hexCode:""}),e=a(""),i=a([]),s=a([]),r=a(!1),c=a([]),d=a([]),h=a([]),u=a([]),g=a(!1),p=a([]),m=a(!1),f=a(!1),y=a(null),L=a(null),P=a(!1),$=a(!1),I=a([]),C=a([]),b=a(!1),v=a(!1),z=a(!0),x=a(!1),D=a(!1),S=a(!1),w=a(!1),B=M(new Array(16).fill().map((N,k)=>k+35)),U=a({name:"",englishName:"",categoryId:null,guaranty:"",brand:"",description:"",regularPrice:null,discount:null,stock:null,image:{name:{},url:"",isMainImage:!0}});return{menu:r,sizes:B,color:t,action:e,colors:i,brands:s,gallery:c,product:U,loading:g,features:d,articles:h,categories:u,colorDialog:f,pageLoading:m,variantsList:p,colorLoading:P,brandLoading:$,selectedSize:y,selectedColor:L,addColorLoading:b,brandSearchMenu:v,mainImageLoading:x,selectedSizesList:I,categoriesLoading:z,noCategoryWarning:D,selectedColorsList:C,confirmationDialog:S,galleryImageLoading:w}},mounted(){this.action=this.$route.query.action,this.getColors(),this.getCategories(),this.action=="edit"&&this.getProductData()},methods:{closeSelect(){document.querySelectorAll("#custom_select").blur()},getCategories(){this.categoriesLoading=!0,this.$axios.get(F).then(t=>{this.categories=t.data,this.categoriesLoading=!1,t.data.length||(this.noCategoryWarning=!0)}).catch(t=>{this.categoriesLoading=!1})},addGallery(){this.gallery.push({name:{},url:"",isMainImage:!1})},addFeature(){this.features.push({name:"",value:""})},removeFromFeaturs(t){this.features.splice(t,1)},addArticle(){this.articles.push({title:"",text:""})},removeFromArticles(t){this.articles.splice(t,1)},showGalleryAlert(){this.disabledGalleryPlusBtn&&this.$toast.warning("ابتدا آخرین تصویر ایجاد شده را آپلود کنید")},showFeatureAlert(){this.disabledFeaturePlusBtn&&this.$toast.warning("ابتدا فیلدهای ویژگی‌ را پر کنید")},showVariantAlert(){this.disabledVariantPlusBtn&&this.$toast.warning("ابتدا تمامی فیلدها را پر کنید")},showArticleAlert(){this.disabledArticlePlusBtn&&this.$toast.warning("ابتدا تمامی فیلدها را پر کنید")},openColorDialog(){this.color={name:"",hexCode:""},this.colorDialog=!0},getColors(){this.colorLoading=!0,this.$axios.get(`${n}?page=1&pageSize=200`).then(t=>{this.colors=t.data,this.colorLoading=!1}).catch(t=>{this.colorLoading=!1})},addNewColor(){this.addColorLoading=!0,this.$axios.post(n,{name:this.color.name,hexCode:this.color.hexCode}).then(t=>{this.$toast.success(t.data.message),this.colorDialog=!1,this.color={name:"",hexCode:""},this.getColors(),this.addColorLoading=!1}).catch(t=>{this.addColorLoading=!1})},submitProduct(){let t=[];t.push(this.product.image),this.gallery.length&&(this.gallery=this.gallery.filter(s=>s.url),this.gallery=this.gallery.filter(s=>s.url),this.gallery.forEach(s=>{t.push(s)})),t=t.map(s=>({name:s.name,isMainImage:s.isMainImage}));const e=new FormData;this.action=="edit"&&e.append("id",this.$route.query.id),e.append("name",this.product.name),e.append("englishName",this.product.englishName),e.append("guaranty",this.product.guaranty),e.append("description",this.product.description),e.append("brand",this.product.brand),e.append("categoryId",this.product.categoryId),this.articles.forEach((s,r)=>{e.append(`articles[${r}].title`,s.title),e.append(`articles[${r}].text`,s.text)}),this.features.forEach((s,r)=>{e.append(`features[${r}].name`,s.name),e.append(`features[${r}].value`,s.value)}),this.variantsList.map(s=>({regularPrice:s.regularPrice,hasDiscount:s.hasDiscount,colorId:s.colorId,price:s.regularPrice&&s.discount?s.regularPrice-s.regularPrice*s.discount/100:s.regularPrice?s.regularPrice:null,stock:s.stock,size:s.size})).forEach((s,r)=>{e.append(`variants[${r}].regularPrice`,s.regularPrice),e.append(`variants[${r}].hasDiscount`,s.hasDiscount),e.append(`variants[${r}].colorId`,s.colorId),e.append(`variants[${r}].price`,s.price),e.append(`variants[${r}].stock`,s.stock),e.append(`variants[${r}].size`,s.size)}),t[0].name.name&&this.action=="new"&&t.forEach((s,r)=>{e.append(`images[${r}].name`,s.name),e.append(`images[${r}].isMainImage`,s.isMainImage)}),this.action=="new"?this.addProduct(e):this.editProduct(e)},addProduct(t){this.loading=!0,this.$axios.post(o,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$toast.success(e.data.message),this.colorDialog=!1,this.loading=!1,this.$router.push("/adminProducts")}).catch(e=>{this.loading=!1})},editProduct(t){this.loading=!0,this.$axios.put(o,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.$toast.success(e.data.message),this.colorDialog=!1,this.loading=!1,this.$router.push("/adminProducts")}).catch(e=>{this.loading=!1})},searchInBrands(){this.brandLoading=!0,this.brandSearchMenu=!1,this.$axios.get(`${A}?filter=${this.product.brand}`).then(t=>{this.brands=t.data,t.data.length&&(this.brandSearchMenu=!0),this.brandLoading=!1}).catch(t=>{this.brandLoading=!1})},removeColorFromList(t){this.selectedColorsList.splice(t,1)},removeSizeFromList(t){this.selectedSizesList.splice(t,1)},createVariantsList(){this.variantsList.length?this.confirmationDialog=!0:this.selectedColorsList.forEach(t=>{this.selectedSizesList.forEach(e=>{this.variantsList.push({colorId:t.id,colorName:t.name,colorHexCode:t.hexCode,regularPrice:this.product.regularPrice?this.product.regularPrice:null,discount:this.product.discount?this.product.discount:null,hasDiscount:!!this.product.discount,price:this.product.regularPrice&&this.product.discount?this.product.regularPrice-this.product.regularPrice*this.product.discount/100:this.product.regularPrice?this.product.regularPrice:null,stock:this.product.stock?this.product.stock:null,size:e})})})},forceToCreateVariantsList(){this.variantsList=[],this.confirmationDialog=!1,this.createVariantsList()},uploadMainImage(t){this.product.image.name=t.target.files[0];var e=6*1024*1024;this.product.image.name.size>e?(this.product.image.name={},this.$toast.error("حجم فایل مورد نظر نمی‌تواند از 6mb بیشتر باشد!")):this.action=="new"?this.product.image.url=URL.createObjectURL(this.product.image.name):this.doUpload(!0)},uploadGalleryImage(t){this.gallery[this.gallery.length-1].name=t.target.files[0];var e=6*1024*1024;this.gallery[this.gallery.length-1].name.size>e?(this.gallery[this.gallery.length-1].name={},this.$toast.error("حجم فایل مورد نظر نمی‌تواند از 6mb بیشتر باشد!")):this.action=="new"?this.gallery[this.gallery.length-1].url=URL.createObjectURL(this.gallery[this.gallery.length-1].name):this.doUpload(!1)},async doUpload(t){t?this.mainImageLoading=!0:this.galleryImageLoading=!0;const e=new FormData;t?e.append("Image",this.product.image.name):e.append("Image",this.gallery[this.gallery.length-1].name),e.append("ProductId",this.$route.query.id),e.append("IsMainImage",t),await this.$axios.put(l,e,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{t?this.product.image.url=URL.createObjectURL(this.product.image.name):this.gallery[this.gallery.length-1].url=URL.createObjectURL(this.gallery[this.gallery.length-1].name),this.$toast.success("تصویر با موفقیت بارگذاری شد"),this.mainImageLoading=!1,this.galleryImageLoading=!1}).catch(i=>{console.log(i),this.$toast.error("خطایی در آپلود تصویر رخ داده است. مجددا تلاش کنید"),this.mainImageLoading=!1,this.galleryImageLoading=!1})},deleteImageGallery(t,e){this.$axios.delete(l,{data:{imageId:t,productId:this.$route.query.id}}).then(i=>{this.gallery.splice(e,1)}).catch(i=>{})},removeImage(t){this.gallery.splice(t,1)},getProductData(){this.pageLoading=!0,this.$axios.get(`${o}/${this.$route.query.id}`).then(t=>{this.product=t.data,this.product.categoryId=t.data.category.id,this.product.image={id:t.data.images[0].id,name:{},url:`${this.$cdnUrl}${t.data.images[0].name}`,isMainImage:!0},this.gallery=t.data.images.filter(e=>!e.isMainPicture).map(e=>({id:e.id,name:{},url:`${this.$cdnUrl}${e.name}`,isMainImage:!1})),this.features=t.data.features.map(e=>({name:e.name,value:e.value})),this.variantsList=t.data.varians.map(e=>({size:e.size,price:e.price,stock:e.stock,colorId:e.color.id,colorName:e.color.name,hasDiscount:e.hasDiscount,discount:e.discountPercent,regularPrice:e.regularPrice,colorHexCode:e.color.hexCode})),this.selectedColorsList=t.data.varians.map(e=>({id:e.color.id,name:e.color.name,hexCode:e.color.hexCode})).reduce((e,i)=>(e.some(s=>s.id===i.id)||e.push(i),e),[]),this.selectedSizesList=t.data.varians.map(e=>e.size).reduce((e,i)=>(e.some(s=>s===i)||e.push(i),e),[]),this.articles=t.data.articles.map(e=>({title:e.title,text:e.text})),this.pageLoading=!1}).catch(t=>{console.log(t),this.pageLoading=!1})}},computed:{disabledGalleryPlusBtn(){return this.gallery.some(t=>!t.url)},disabledFeaturePlusBtn(){return this.features.some(t=>t.name===""||t.value==="")},disabledVariantPlusBtn(){return this.variants.some(t=>!t.colorId||!t.price||!t.stock)},disabledArticlePlusBtn(){return this.articles.some(t=>t.title===""||t.text==="")},disabledSubmitButton(){var t,e;return this.action=="add"?!!(!this.product.name||!this.product.brand||!this.product.categoryId||!this.product.englishName||!this.product.description||!this.variantsList.length||!this.product.regularPrice||this.disabledFeaturePlusBtn||!((t=this.product.image)!=null&&t.url)||this.variantsList.some(i=>!i.regularPrice||!i.stock)||this.disabledArticlePlusBtn):!!(!this.product.name||!this.product.brand||!this.product.categoryId||!this.product.englishName||!this.product.description||!this.variantsList.length||this.disabledFeaturePlusBtn||!((e=this.product.image)!=null&&e.url)||this.variantsList.some(i=>!i.regularPrice||!i.stock)||this.disabledArticlePlusBtn)}},watch:{"color.hexCode":function(t){this.menu=!1},selectedColor(t){t&&this.selectedColorsList.push(t),this.selectedColor=null},selectedSize(t){t&&this.selectedSizesList.push(t),this.selectedSize=null}}};export{q as default};
